<%
require "luci.fs"
<!--local has_ipv6 = luci.fs.access("/proc/net/ipv6_route")-->
<!--local has_dhcp = luci.fs.access("/etc/config/dhcp")-->
<!--local has_wifi = luci.fs.stat("/etc/config/wireless")-->
<!--has_wifi = has_wifi and has_wifi.size > 0-->
<!--local _, _, memtotal, memcached, membuffers, memfree, _, swaptotal, swapcached, swapfree = luci.sys.sysinfo()-->
<!--local has_swap-->
<!--if swaptotal > 0 then-->
<!--has_swap = 1-->
<!--end-->
<!--local has_dsl = luci.fs.stat("/etc/init.d/dsl_control")-->

local system, model = luci.sys.sysinfo()
local msg="ceshui"
-%>
<html data-n-head-ssr>
<head>
    <title>keyan</title>
    <meta data-n-head="ssr" charset="utf-8">
    <meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1">
    <meta data-n-head="ssr" data-hid="description" name="description"
          content="My wicked Nuxt.js project">
    <link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico">
    <base href="/">
    <link rel="stylesheet" href="/luci-static/bootstrap/cascade.css">
    <style data-vue-ssr-id="3191d5ad:0 932a8f60:0 15a56e0c:0">.nuxt-progress {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        width: 0;
        opacity: 1;
        transition: width .1s, opacity .4s;
        background-color: #fff;
        z-index: 999999
    }

    html {
        font-family: Source Sans Pro, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif;
        font-size: 16px;
        word-spacing: 1px;
        -ms-text-size-adjust: 100%;
        -webkit-text-size-adjust: 100%;
        -moz-osx-font-smoothing: grayscale;
        -webkit-font-smoothing: antialiased;
        box-sizing: border-box
    }

    *, :after, :before {
        box-sizing: border-box;
        margin: 0
    }

    .button--green {
        width: 80%;
        display: inline-block;
        border-radius: 4px;
        border: 1px solid #3b8070;
        color: #3b8070;
        text-decoration: none;
        margin: 20px;
        padding: 10px 30px
    }

    .button--green:hover {
        color: #fff;
        background-color: #3b8070
    }

    .divStyle {
        background: #eeeeee;
        display: flex;
        justify-content: center;
    }

    .main > h1[data-v-42a6d4b0] {
        text-align: center;
        letter-spacing: 1px;
        padding: 30px 0;
        color: #fff;
        background: #8db9ff
    }

    .main .btn > a[data-v-42a6d4b0] {
        margin: 0 10px;
        display: block;
        cursor: pointer;
        text-align: center;
        line-height: 300px;
        border-radius: 15px;
        width: 200px;
        height: 300px
    }

    .main .btn > a.left > p[data-v-42a6d4b0] {
        color: #fff;
        letter-spacing: 1px;
        font-size: 24px;
        font-weight: 600
    }

    .main .btn > a.right > p[data-v-42a6d4b0] {
        color: #fff;
        letter-spacing: 1px;
        font-size: 24px;
        font-weight: 600
    }</style>
</head>
<body>
<div class="main" data-v-42a6d4b0>
    <h1 data-v-42a6d4b0>功能页面</h1>
</div>

<div class="divStyle">
    <input type="button" value="<%:wifi%>" class="button--green"/>
</div>
<fieldset class="cbi-section">
    <legend><%:System%></legend>

    <table class="cbi-section-table">
        <tr class="cbi-section-table-row">
            <td><%:Hostname%></td>
            <td><%=luci.sys.hostname() or "?"%></td>
        </tr>
        <tr class="cbi-section-table-row">
            <td><%:Model%></td>
            <td><%=pcdata(model or "?")%></td>
        </tr>
        <tr class="cbi-section-table-row">
            <td><%:Firmware Version%></td>
            <td>
                <%=pcdata(luci.version.distname)%> <%=pcdata(luci.version.distversion)%> /
                <%=pcdata(luci.version.luciname)%> (<%=pcdata(luci.version.luciversion)%>)
            </td>
        </tr>
        <tr class="cbi-section-table-row">
            <td><%:Kernel Version%></td>
            <td><%=luci.sys.exec("uname -r")%></td>
        </tr>
        <tr class="cbi-section-table-row">
            <td><%:系统信息%></td>
            <td id="system"><%=system%>/<%=model%></td>
        </tr>
        <tr class="cbi-section-table-row">
            <td><%:全部信息%></td>
            <td id="allInfo"><%=luci.http.formvalue("wan")%>/<%=msg%>/<%=type(rv)%>/<%=status%></td>
        </tr>
    </table>
</fieldset>

<fieldset class="cbi-section" style="display:none">
    <legend><%:DHCPv6 Leases%></legend>

    <table class="cbi-section-table" id="lease6_status_table">
        <tr class="cbi-section-table-titles">
            <th class="cbi-section-table-cell"><%:Hostname%></th>
            <th class="cbi-section-table-cell"><%:IPv6-Address%></th>
            <th class="cbi-section-table-cell"><%:DUID%></th>
            <th class="cbi-section-table-cell"><%:Leasetime remaining%></th>
        </tr>
        <tr class="cbi-section-table-row">
            <td colspan="4"><em><br/><%:Collecting data...%></em></td>
        </tr>
    </table>
</fieldset>

<script>window.__NUXT__ = {
    layout: "default",
    data: [{}],
    fetch: [],
    error: null,
    serverRendered: !0,
    routePath: "/"
}</script>

<%-
local dsp = require "luci.dispatcher"
-%>


<script type="text/javascript" src="<%=resource%>/xhr.js"></script>
<script type="text/javascript">
    var stxhr = new XHR();
    stxhr.get('<%=dsp.build_url("admin/demo/demo1/readDemo")%>', {status: 1},
        function (x, info) {
            console.log(info)
            var ss = JSON.stringify(info)
            console.log(ss)
            var ls6 = document.getElementById('lease6_status_table');
            if (ls6 && info.leases6) {
                ls6.parentNode.style.display = 'block';
                /* clear all rows */
                while (ls6.rows.length > 1)
                    ls6.rows[0].parentNode.deleteRow(1);
                for (var i = 0; i < info.leases6.length; i++) {
                    var timestr;

                    if (info.leases6[i].expires <= 0)
                        timestr = '<em><%:expired%></em>';
                    else
                        timestr = info.leases6[i].expires;

                    var tr = ls6.rows[0].parentNode.insertRow(-1);
                    tr.className = 'cbi-section-table-row cbi-rowstyle-' + ((i % 2) + 1);

                    tr.insertCell(-1).innerHTML = info.leases6[i].hostname ? info.leases6[i].hostname : '?';
                    tr.insertCell(-1).innerHTML = info.leases6[i].ip6addr;
                    tr.insertCell(-1).innerHTML = info.leases6[i].duid;
                    tr.insertCell(-1).innerHTML = timestr;
                }
                if (ls6.rows.length === 1) {
                    var tr = ls6.rows[0].parentNode.insertRow(-1);
                    tr.className = 'cbi-section-table-row';

                    var td = tr.insertCell(-1);
                    td.colSpan = 4;
                    td.innerHTML = '<em><br /><%:There are no active leases.%></em>';
                }
            }
        }
    );
</script>

</body>
</html>
